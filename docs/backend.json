{
  "entities": {
    "Patient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Patient",
      "type": "object",
      "description": "Represents a patient receiving homecare services.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the patient."
        },
        "name": {
          "type": "string",
          "description": "The patient's full name."
        },
        "cpf": {
            "type": "string",
            "description": "The patient's CPF document number."
        },
        "dateOfBirth": {
          "type": "string",
          "description": "The patient's date of birth.",
          "format": "date-time"
        },
         "bloodType": {
            "type": "string",
            "description": "The patient's blood type."
        },
        "age": {
            "type": "number",
            "description": "The patient's age."
        },
        "avatarUrl": {
            "type": "string",
            "description": "URL for the patient's avatar image."
        },
         "avatarHint": {
            "type": "string",
            "description": "A hint for AI to find a similar image."
        },
        "familyContact": {
            "type": "object",
            "properties": {
                "name": {"type": "string"},
                "phone": {"type": "string"}
            }
        },
        "allergies": {
            "type": "array",
            "items": { "type": "string" },
            "description": "A list of the patient's known allergies."
        },
        "chronicConditions": {
             "type": "array",
            "items": { "type": "string" },
            "description": "A list of the patient's chronic conditions."
        },
        "medications": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "name": {"type": "string"},
                    "dosage": {"type": "string"},
                    "frequency": {"type": "string"},
                    "notes": {"type": "string"}
                },
                 "required": ["name", "dosage", "frequency"]
            },
            "description": "A list of medications the patient is taking."
        },
        "diet": {
            "type": "string",
            "description": "Dietary restrictions and recommendations for the patient."
        },
        "medicalHistory": {
          "type": "string",
          "description": "A detailed record of the patient's medical history; consider storing a reference to an external document or system for full details."
        },
        "carePlan": {
          "type": "string",
          "description": "Description of the patient's care plan."
        }
      },
      "required": [
        "id",
        "name",
        "dateOfBirth",
        "medicalHistory",
        "carePlan",
        "familyContact"
      ]
    },
    "Supply": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Supply",
      "type": "object",
      "description": "Represents a supply item used in patient care.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the supply item."
        },
        "name": {
          "type": "string",
          "description": "The name of the supply item."
        },
        "description": {
          "type": "string",
          "description": "A description of the supply item."
        },
        "unit": {
          "type": "string",
          "description": "The unit of measure for the supply (e.g., 'mL', 'count')."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "unit"
      ]
    },
    "Inventory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Inventory",
      "type": "object",
      "description": "Represents the inventory level of a specific supply item for a patient.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the inventory record."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N Inventory)"
        },
        "supplyId": {
          "type": "string",
          "description": "Reference to Supply. (Relationship: Supply 1:N Inventory)"
        },
        "quantity": {
          "type": "number",
          "description": "The current quantity of the supply item in inventory."
        },
        "lastUpdated": {
          "type": "string",
          "description": "Timestamp of the last inventory update.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "patientId",
        "supplyId",
        "quantity",
        "lastUpdated"
      ]
    },
    "SupplyRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SupplyRequest",
      "type": "object",
      "description": "Represents a request for supplies made by the care team to the family.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the supply request."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N SupplyRequest)"
        },
        "supplyId": {
          "type": "string",
          "description": "Reference to Supply. (Relationship: Supply 1:N SupplyRequest)"
        },
        "quantityRequested": {
          "type": "number",
          "description": "The quantity of the supply item requested."
        },
        "requestDate": {
          "type": "string",
          "description": "The date and time the request was made.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the request (e.g., 'Pending', 'Approved', 'Denied')."
        },
        "notes": {
          "type": "string",
          "description": "Optional notes related to the supply request."
        }
      },
      "required": [
        "id",
        "patientId",
        "supplyId",
        "quantityRequested",
        "requestDate",
        "status"
      ]
    },
    "CareTeamMember": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CareTeamMember",
      "type": "object",
      "description": "Represents a member of the patient's care team.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the care team member."
        },
        "name": {
          "type": "string",
          "description": "The name of the care team member."
        },
        "role": {
          "type": "string",
          "description": "The role of the care team member (e.g., 'Nurse', 'Therapist')."
        },
        "contactNumber": {
          "type": "string",
          "description": "The contact number of the care team member."
        }
      },
      "required": [
        "id",
        "name",
        "role",
        "contactNumber"
      ]
    },
    "ShiftReport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ShiftReport",
      "type": "object",
      "description": "Represents a shift report submitted by a care team member.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the shift report."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N ShiftReport)"
        },
        "careTeamMemberId": {
          "type": "string",
          "description": "Reference to CareTeamMember. (Relationship: CareTeamMember 1:N ShiftReport)"
        },
        "shiftStartTime": {
          "type": "string",
          "description": "The start time of the shift.",
          "format": "date-time"
        },
        "shiftEndTime": {
          "type": "string",
          "description": "The end time of the shift.",
          "format": "date-time"
        },
        "observations": {
          "type": "string",
          "description": "Observations and notes from the shift."
        },
        "reportDate": {
          "type": "string",
          "description": "The date the report was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "patientId",
        "careTeamMemberId",
        "shiftStartTime",
        "shiftEndTime",
        "observations",
        "reportDate"
      ]
    },
    "WhatsAppNotification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WhatsAppNotification",
      "type": "object",
      "description": "Represents a WhatsApp notification sent by the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the notification."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to Patient. (Relationship: Patient 1:N WhatsAppNotification)"
        },
        "message": {
          "type": "string",
          "description": "The content of the WhatsApp message."
        },
        "recipient": {
          "type": "string",
          "description": "The recipient of the message (e.g., phone number)."
        },
        "sentTimestamp": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        },
        "notificationType": {
          "type": "string",
          "description": "Type of notification (e.g., 'Supply Request', 'Rule Change', 'Shift Reminder')."
        }
      },
      "required": [
        "id",
        "patientId",
        "message",
        "recipient",
        "sentTimestamp",
        "notificationType"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/patients/{patientId}",
        "definition": {
          "entityName": "Patient",
          "schema": {
            "$ref": "#/backend/entities/Patient"
          },
          "description": "Represents a single patient's core information. This document acts as a root for most patient-specific data.",
          "params": [
            {
              "name": "patientId",
              "description": "Unique identifier for the patient."
            }
          ]
        }
      },
      {
        "path": "/supplies/{supplyId}",
        "definition": {
          "entityName": "Supply",
          "schema": {
            "$ref": "#/backend/entities/Supply"
          },
          "description": "Represents available supply items. No authorization context is needed.",
          "params": [
            {
              "name": "supplyId",
              "description": "Unique identifier for the supply item."
            }
          ]
        }
      },
      {
        "path": "/patients/{patientId}/inventories/{inventoryId}",
        "definition": {
          "entityName": "Inventory",
          "schema": {
            "$ref": "#/backend/entities/Inventory"
          },
          "description": "Represents the inventory level of a specific supply item for a patient. Nested under the patient document for easy access and security.",
          "params": [
            {
              "name": "patientId",
              "description": "Unique identifier for the patient."
            },
            {
              "name": "inventoryId",
              "description": "Unique identifier for the inventory record."
            }
          ]
        }
      },
      {
        "path": "/patients/{patientId}/supplyRequests/{supplyRequestId}",
        "definition": {
          "entityName": "SupplyRequest",
          "schema": {
            "$ref": "#/backend/entities/SupplyRequest"
          },
          "description": "Represents a supply request made for the patient. Nested under the patient document.",
          "params": [
            {
              "name": "patientId",
              "description": "Unique identifier for the patient."
            },
            {
              "name": "supplyRequestId",
              "description": "Unique identifier for the supply request."
            }
          ]
        }
      },
      {
        "path": "/patients/{patientId}/shiftReports/{shiftReportId}",
        "definition": {
          "entityName": "ShiftReport",
          "schema": {
            "$ref": "#/backend/entities/ShiftReport"
          },
          "description": "Represents a shift report submitted for the patient. Nested under the patient document.",
          "params": [
            {
              "name": "patientId",
              "description": "Unique identifier for the patient."
            },
            {
              "name": "shiftReportId",
              "description": "Unique identifier for the shift report."
            }
          ]
        }
      },
      {
        "path": "/patients/{patientId}/whatsAppNotifications/{notificationId}",
        "definition": {
          "entityName": "WhatsAppNotification",
          "schema": {
            "$ref": "#/backend/entities/WhatsAppNotification"
          },
          "description": "Represents a WhatsApp notification sent related to the patient. Nested under the patient document.",
          "params": [
            {
              "name": "patientId",
              "description": "Unique identifier for the patient."
            },
            {
              "name": "notificationId",
              "description": "Unique identifier for the notification."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage homecare for a single patient, focusing on inventory, supply requests, communication, and AI-assisted features. Given that the application is centered around *one* patient, a top-level document for the patient can act as the root for much of the data, simplifying data access and security rules. The structure leverages path-based ownership for patient-related data and denormalization where needed to ensure authorization independence.\n\n**Authorization Independence (CRITICAL):**\n*   Most collections (Inventory, SupplyRequest, ShiftReport, WhatsAppNotification) are structured as subcollections under the `/patients/{patientId}` document. This allows for simple, path-based security rules, ensuring that only authorized care team members and family contacts can access patient-specific data. Because all data is nested under a specific `/patients/{patientId}`, authorization is simplified to the point of checking for the existence of an authenticated user. \n\n*   For Collaborative Data - there are no group permissions in this case, all data is related to a single patient.\n\n**Structural Segregation:**\n*   The structure separates different data types into distinct collections to maintain a homogeneous security posture. For example, `supplies` are stored in a top-level collection, separate from patient-specific data.\n\n**Access Modeling:**\n*   **Path-Based Ownership:** Collections like `inventories`, `supplyRequests`, `shiftReports`, and `whatsAppNotifications` are subcollections of `/patients/{patientId}`, enforcing ownership. This simplifies security rules based on the active patient.\n\n**QAPs (Rules are not Filters):**\n*   The structure supports secure `list` operations. The nesting of patient-specific data ensures that querying collections such as `/patients/{patientId}/inventories` only returns inventory data for the specific patient, preventing unauthorized data access.\n\n**Denormalization**: Given this is a single patient app, we have opted to not denormalize any data. With added complexity and a new patient requirement this would be updated."
  }
}